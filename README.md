# Ejercicio SISU Technologies

**Planteamiento del problema** 

Uno de los casos de uso de una determinada aplicaciÃ³n web es pedir que los usuarios dejen la siguiente informaciÃ³n:

- Nombre 
- Edad
- Ciudad

Esta informaciÃ³n serÃ¡ capturada dentro de una forma. Actualmente se cuenta con una serie de servicios web desarrollados que realizan las siguientes funciones:

- Obtener el listado de paÃ­ses disponibles.

- Obtener el listado de estados de un paÃ­s (por medio del identificador del paÃ­s).

- Obtener el listado de ciudades de un estado (por medio del identificador del estado).

- Guardar los datos del usuario.

## Tarea Principal

Desarrollar una pÃ¡gina usando Ãºnicamente HTML, Javascript y CSS que cumpla con la interacciÃ³n anterior. La soluciÃ³n deberÃ¡ de tener el comportamiento mostrado en el video adjunto câ€‹ omo mÃ­nimoâ€‹. Para el ingreso del paÃ­s, el estado y la ciudad se utilizarÃ¡n controles de dropdown. La interacciÃ³n serÃ¡ de la siguiente forma:

- Inicialmente los dropdowns de estado y ciudad deberÃ¡n de estar vacÃ­os o no existir.

- El dropdown de paÃ­s deberÃ¡ de inicialmente estar populado con los paÃ­ses.

- Al seleccionar un Ã­tem del dropdown de paÃ­ses se debe de popular el dropdown de estados con los estados del paÃ­s seleccionado.

- Al seleccionar un Ã­tem del dropdown de estados se debe de popular el dropdown de ciudades con las ciudades del estado seleccionado.

- Se debe de validar:
    - El nombre debe de ser de 50 caracteres mÃ¡ximo y Ãºnicamente pueden ingresar letras (considerar acentos), espacios y puntos.

    - La edad debe ser entre 18 y 99 aÃ±os (inclusivo).

- Al someter la forma se deben de enviar los siguientes datos al servicio web para guardar:
    - Nombre

    - Edad

    - Identificador de la ciudad

Una vez sometida la informaciÃ³n la pÃ¡gina debe mostrar el mensaje regresado por el servicio web.

## Consideraciones tÃ©cnicas

- La soluciÃ³n debe de utilizar comunicaciÃ³n asÃ­ncrona entre la pÃ¡gina y el servidor (AJAX) para popular todos los dropdowns y hacer el envÃ­o de los datos del usuario.

- Se deben de validar los datos ingresados en la pÃ¡gina antes de enviarlos a los servicios web.

- No hay restricciones de marcos de trabajo o librerÃ­as posibles a utilizar, siempre y cuando sean de Javascript y sin necesidad de instalar algo adicional.

- El header de Content-Type de toda la comunicaciÃ³n hecha por POST debe ser "application/json", de lo contrario no responderÃ¡ el backend.

## Aspectos a evaluar

Los siguiente son puntos que serÃ¡n evaluados en la soluciÃ³n:

- Cumplimiento de todos los requerimientos.
- Que no haya errores.
- AtenciÃ³n al detalle.
- Claridad del cÃ³digo.
- DocumentaciÃ³n de cÃ³digo.
- DiseÃ±o lÃ³gico y grÃ¡fico.
- Creatividad y calidad de la soluciÃ³n.
- El tiempo que tomÃ³ realizar la prueba (esto se reporta al entregarla).
- DecisiÃ³n de hacer la tarea adicional y su calidad [(ver mÃ¡s abajo)](#tarea-adicional).

## Tarea adicional

Esta tarea no es obligatoria, pero serÃ¡ tomada en consideraciÃ³n si se envÃ­a junto con la soluciÃ³n.

- Modificar el backend para que los datos de los nuevos usuarios que se reciban sean guardados en una base de datos. Puede ser MySQL, PostgreSQL o una base de datos en memoria como H2.

- Entregar un ejecutable compilado con estas modificaciones y su respectivo cÃ³digo fuente.


## Material a entregar

- Archivos HTML, CSS y Javascript con la soluciÃ³n.

- Todos los archivos que se entreguen deben estar listos para usarse/montarse/correrse. Para evaluarlo, no deben requerir realizar algÃºn build.

- Si para evaluar se requiere hacer algo ademÃ¡s de abrir el archivo index.html, favor de adjuntar un readme con explicaciones.

- Entregarlos usando el dashboard de candidato desde donde se descargaron.

    - Importante especificar cuÃ¡ntas horas se invirtieron en el ejercicio. Se espera honestidad y transparencia.

    - Importante enviar esto antes del deadline que establece la plataforma, de lo contrario no se continuarÃ¡ en el proceso.

- En caso de â€‹no hacer la tarea adicional, por favor no incluyan el archivo ejecutable .jar y respectivo cÃ³digo fuente del backend.

- En caso de â€‹sÃ­ haber hecho la tarea adicional, incluir ademÃ¡s del cÃ³digo fuente, la versiÃ³n compiladaâ€‹ del archivo .jar, lista para correrse.

## InstalaciÃ³n de los servicios web (backend)

Los servicios web estÃ¡n desarrollados usando Spring. Se hace uso de Spring Boot para la ejecuciÃ³n, por lo que no es necesario instalar un servidor de aplicaciones.

**Requerimientos**

- JRE (Java Runtime Environment) 8 para ejecutar el backend
- JDK (Java Development Kit) 8 y Maven para compilar el backend

**Instrucciones**

Existen 2 carpetas:
- /fuente_servidor: Contiene el cÃ³digo fuente del backend
- /ejecutable: Contiene el backend en un archivo ejecutable

**EjecuciÃ³n**

Para correr el servidor con el backend simplemente hay que ejecutar el archivo .jar en la carpeta de /ejecutable, usando:

```bash
java -jar challengeajax-0.0.1-SNAPSHOT.jar
```

Esto levantarÃ¡ el servidor de forma local en el puerto 8080. No debe de existir algÃºn otro servicio corriendo en ese puerto.

```bash
http://localhost:8080
```

**EdiciÃ³n**

El cÃ³digo fuente del backend se encuentra en la carpeta /fuente_servidor. En caso de modificarlo se puede compilar y correr el servidor en modo de desarrollo usando:

```bash
mvn spring-boot:run
```

Como nota adicional, si se desea re-empacar el cÃ³digo como un archivo .jar como el que estÃ¡ en la carpeta /ejecutable, hay que usar el comando:

```bash
mvn clean package
```

Esto crearÃ¡ una carpeta /target con el archivo jar compilado.

## DocumentaciÃ³n y URLs de los servicios web

Para visualizar la documentaciÃ³n de los servicios web hay que ir a la direcciÃ³n:

```bash
http://localhost:8080/docapi/index.html
```

ðŸ”¸ **Es muy importante revisar la documentaciÃ³n de los servicios web para hacer el ejercicio.**

Se puede encontrar en esa direcciÃ³n la funcionalidad de cada servicio web, la URL y el mÃ©todo (GET o POST) aceptado por cada uno. Adicionalmente se pueden hacer pruebas con ellos usando diferentes parÃ¡metros.

El nombre del API es *servicio*. ðŸŸ¡


## SoluciÃ³n

![formulario](/assests/form.png)


```javascript

async function postData(url = '', data = {}) {
    console.log(data);
    const response = await fetch(
        url,
        {
            mode: 'cors',
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data),
        }
    );

    const retrieveData = await response.json();
    return retrieveData;
    
};

async function getData(url = '') {
    const response = await fetch(
        url,
        {
            mode: 'cors',
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            },
        }
    );
    const data = await response.json();
    return data
  };

async function defaultOption(idElement, dropdown){
    const defaultOption = document.createElement('option');
    defaultOption.textContent = 'Select a ' + idElement;
    defaultOption.value = '';
    defaultOption.disabled = true;
    defaultOption.selected = true; 
    dropdown.appendChild(defaultOption);

    return dropdown
};

async function fillDropdown(data, idDropdown){

    const Dropdown = document.getElementById(idDropdown);
    Dropdown.innerHTML = '';

    defaultOption(idDropdown, Dropdown)
    // Add new options based on states data
    data.forEach(element => {
        const option = document.createElement('option');
        option.value = element.id;
        option.textContent = element.nombre;
        Dropdown.appendChild(option);
    });

};

async function loadData(url, id, idDropdown){

    const data = await postData(url, id);
    fillDropdown(data, idDropdown);

};

async function sentToDropdown() {
    try {

       
        const countries = await getData("http://localhost:8080/servicio/paises");

        const countryDropdown = document.getElementById('country');
        const stateDropdown = document.getElementById('state');
        const cityDropdown = document.getElementById('city');
    

        defaultOption('country', countryDropdown);
        defaultOption('state', stateDropdown);
        defaultOption('city', cityDropdown);
        
        countries.forEach(element => {
            const option = document.createElement('option');
            option.value = element.id;
            option.textContent = element.nombre;

            countryDropdown.appendChild(option);
        });

        countryDropdown.addEventListener(
            'change', function() {
                // const stateDropdown = document.getElementById('state');
                if (this.value) {
                    stateDropdown.disabled = false;
                    loadData("http://localhost:8080/servicio/estados", this.value, 'state')

                } else {
                    stateDropdown.disabled = true;
                }

                cityDropdown.disabled = true;
            });
        
        stateDropdown.addEventListener(
            'change', function(){
                if (this.value) {
                    cityDropdown.disabled = false;
                    loadData("http://localhost:8080/servicio/ciudades", this.value, 'city')
                } else {
                    cityDropdown.disabled = true;
                }
            }
        );

    }
    catch (error){
        console.log('Faild to sent data to dropdown: ', error)
    }
}

sentToDropdown();

document.addEventListener('DOMContentLoaded', (event)=>{

    const registerForm = document.getElementById('register');

    if (registerForm) {
        registerForm.addEventListener(
            'submit', async function(event){
                event.preventDefault();
        
                let fields = {};
        
                fields['nombre'] = document.getElementById('name').value;
                fields['edad'] = document.getElementById('age').value;
                // fields['paÃ­s'] = document.getElementById('country').value;
                // fields['estado'] = document.getElementById('state').value;
                fields['ciudadId'] = document.getElementById('city').value;

                if (!fields['nombre'].trim() || !fields['edad'].trim() || !fields['ciudadId'].trim()) {
                    alert('Please fill out all required fields.');
                    return;
                }
                
                fields['edad'] = parseInt(fields['edad']);
                fields['ciudadId'] = parseInt(fields['ciudadId']);
                
                const finalResponse = await postData('http://localhost:8080/servicio/guardar', fields);
                console.log(finalResponse.resultado);
         });
    }
});



```